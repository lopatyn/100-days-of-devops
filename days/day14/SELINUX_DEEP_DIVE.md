# üõ°Ô∏è Deep Dive: –ß–æ–º—É Apache –Ω–µ —Å—Ç–∞—Ä—Ç—É—î –Ω–∞ –ø–æ—Ä—Ç—É 5002? (–†–æ–ª—å SELinux)

–ü—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è **Day 14**, –º–∏ –∑—ñ—Ç–∫–Ω—É–ª–∏—Å—è –∑ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–æ–º –ø–æ—Ä—Ç—ñ–≤, —Å–ø—Ä–∏—á–∏–Ω–µ–Ω–∏–º `sendmail`. –ü—Ä–æ—Ç–µ, –Ω–∞–≤—ñ—Ç—å —è–∫–±–∏ –ø–æ—Ä—Ç –±—É–≤ –≤—ñ–ª—å–Ω–∏–º, —É –±–∞–≥–∞—Ç—å–æ—Ö —Å—É—á–∞—Å–Ω–∏—Ö Linux-—Å–∏—Å—Ç–µ–º–∞—Ö (RHEL, CentOS, Fedora, Rocky) –≤–∏ –≤—Å–µ –æ–¥–Ω–æ –º–æ–≥–ª–∏ –± –ø–æ–±–∞—á–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É `(98)Address already in use` –∞–±–æ `Permission denied`. 

–û—Å—å —Ä–æ–∑–±—ñ—Ä —Ç–æ–≥–æ, —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è "–ø—ñ–¥ –∫–∞–ø–æ—Ç–æ–º".

---

## 1. SELinux ‚Äî —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ–∞—î—Ä–≤–æ–ª
SELinux (Security-Enhanced Linux) ‚Äî —Ü–µ –º–µ—Ö–∞–Ω—ñ–∑–º –±–µ–∑–ø–µ–∫–∏ **Mandatory Access Control (MAC)**. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ Linux (–¥–µ –≤—Å–µ –≤–∏—Ä—ñ—à—É—î –≤–ª–∞—Å–Ω–∏–∫ —Ñ–∞–π–ª—É), SELinux –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∫–æ–∂–Ω—É –¥—ñ—é –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å "–ø–æ–ª—ñ—Ç–∏—Ü—ñ –±–µ–∑–ø–µ–∫–∏".

–í—ñ–Ω –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞:
1. **–•—Ç–æ** –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –¥—ñ—è—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ—Ü–µ—Å `httpd`).
2. **–©–æ** –≤—ñ–Ω —Ö–æ—á–µ –∑—Ä–æ–±–∏—Ç–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—ñ–¥–∫—Ä–∏—Ç–∏ TCP-–ø–æ—Ä—Ç).
3. **–û–±'—î–∫—Ç** –¥—ñ—ó (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –Ω–æ–º–µ—Ä –ø–æ—Ä—Ç—É).

## 2. –ú–∞—Ä–∫—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—ñ–≤ (Port Labeling)
SELinux –∑–Ω–∞—î, —è–∫—ñ –ø–æ—Ä—Ç–∏ "–∑–∞–∑–≤–∏—á–∞–π" –Ω–∞–ª–µ–∂–∞—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—É. –¶—ñ –ø–æ—Ä—Ç–∏ –º–∞—é—Ç—å –º—ñ—Ç–∫—É `http_port_t`.

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å–ø–∏—Å–æ–∫ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –ø–æ—Ä—Ç—ñ–≤ –¥–ª—è Apache:**
*   80, 81, 443, 448, 8008, 8080, 8443.

–ü–æ—Ä—Ç **5002** –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º **–Ω–µ –º–∞—î** —Ü—ñ—î—ó –º—ñ—Ç–∫–∏. –ö–æ–ª–∏ Apache –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è "—Å—ñ—Å—Ç–∏" –Ω–∞ –ø–æ—Ä—Ç 5002, SELinux –±–∞—á–∏—Ç—å, —â–æ –ø—Ä–æ—Ü–µ—Å `httpd_t` –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ—Ä—Ç—É, —è–∫–∏–π –Ω–µ –ø–æ–∑–Ω–∞—á–µ–Ω–∏–π —è–∫ `http_port_t`, —ñ **–±–ª–æ–∫—É—î —Ü–µ–π —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫**.

---

## 3. –Ø–∫ –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏ "—Ç–∏—Ö–µ" –±–ª–æ–∫—É–≤–∞–Ω–Ω—è?

–Ø–∫—â–æ –≤–∏ –∑–º—ñ–Ω–∏–ª–∏ `Listen 5002` —É –∫–æ–Ω—Ñ—ñ–≥—É, —ñ `ss -tulnp` –ø–æ–∫–∞–∑—É—î, —â–æ –ø–æ—Ä—Ç –≤—ñ–ª—å–Ω–∏–π, –∞–ª–µ Apache –Ω–µ —Å—Ç–∞—Ä—Ç—É—î ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å–∏—Å—Ç–µ–º–Ω–∏–π –ª–æ–≥ –∞—É–¥–∏—Ç—É:

```bash
# –ü–æ—à—É–∫ –≤—ñ–¥–º–æ–≤ SELinux (AVC denied) –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ–π —á–∞—Å
sudo ausearch -m AVC -ts recent
```

–í–∏ –ø–æ–±–∞—á–∏—Ç–µ —â–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç:
`avc:  denied  { name_bind } for  pid=... comm="httpd" src=5002 scontext=system_u:system_r:httpd_t:s0 ...`

---

## 4. –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ "–¥–æ–º–æ–≤–∏—Ç–∏—Å—è" –∑ SELinux?

–ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –≤–∏–º–∏–∫–∞—Ç–∏ SELinux (`setenforce 0`), —â–æ —î –ø–æ–≥–∞–Ω–æ—é –ø—Ä–∞–∫—Ç–∏–∫–æ—é (Bad Practice), –ø–æ—Ç—Ä—ñ–±–Ω–æ **–¥–æ–¥–∞—Ç–∏** –≤–∞—à –Ω–æ–≤–∏–π –ø–æ—Ä—Ç –¥–æ —Å–ø–∏—Å–∫—É –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö.

### –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—ñ –¥–æ–∑–≤–æ–ª–∏
```bash
sudo semanage port -l | grep http_port_t
```

### –ö—Ä–æ–∫ 2: –î–æ–¥–∞—Ç–∏ –ø–æ—Ä—Ç 5002
```bash
# -a (add), -t (type), -p (protocol)
sudo semanage port -a -t http_port_t -p tcp 5002
```

–¢–µ–ø–µ—Ä Apache –∑–º–æ–∂–µ —Å–ø–æ–∫—ñ–π–Ω–æ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–∞ –Ω–æ–≤–æ–º—É –ø–æ—Ä—Ç—É.

---

## 5. –ü—ñ–¥—Å—É–º–æ–∫ –¥–ª—è —ñ–Ω–∂–µ–Ω–µ—Ä–∞ üß†

*   **–ü–æ—Ä—Ç–∏ < 1024:** –ü–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–∞–≤–∞ `root`.
*   **–ü–æ—Ä—Ç–∏ > 1024:** –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø—Ä–∞–≤–∞ `root` –¥–ª—è bind, **–ê–õ–ï** SELinux –≤—Å–µ –æ–¥–Ω–æ –º–æ–∂–µ —ó—Ö –±–ª–æ–∫—É–≤–∞—Ç–∏, —è–∫—â–æ –≤–æ–Ω–∏ –Ω–µ –º–∞—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –º—ñ—Ç–∫–∏.
*   **–ó–æ–ª–æ—Ç–µ –ø—Ä–∞–≤–∏–ª–æ:** –Ø–∫—â–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞, –ø–æ—Ä—Ç –≤—ñ–ª—å–Ω–∏–π, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É —î, –∞–ª–µ –Ω—ñ—á–æ–≥–æ –Ω–µ –ø—Ä–∞—Ü—é—î ‚Äî **–ø–µ—Ä–µ–≤—ñ—Ä—è–π SELinux**.

---
*–ú–∞—Ç–µ—Ä—ñ–∞–ª –ø—ñ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è –†–æ–º–∞–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö —á–µ–ª–µ–Ω–¥–∂—É 100 Days of DevOps.*
